name: Generate Dependabot Config

on:
  workflow_dispatch: # ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ ì„¤ì • íŒŒì¼ ìƒì„±

permissions:
  contents: write # ì €ì¥ì†Œì— íŒŒì¼ì„ ì“°ê³  ì»¤ë°‹í•  ê¶Œí•œ í•„ìš”

jobs:
  create-dependabot-config:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Create .github directory
        run: mkdir -p .github

      - name: Generate dependabot.yml
        run: |
          cat <<EOF > .github/dependabot.yml
          # --------------------------------------------------------
          # Dependabot Configuration File
          # Automatically generated by GitHub Actions
          # --------------------------------------------------------
          version: 2
          updates:
            # 1. GitHub Actions ì›Œí¬í”Œë¡œìš° ì—…ë°ì´íŠ¸ (ê°€ì¥ ì¤‘ìš”)
            # .github/workflows í´ë” ë‚´ì˜ action ë²„ì „(v4 ë“±)ì„ ìµœì‹ ìœ¼ë¡œ ìœ ì§€
            - package-ecosystem: "github-actions"
              directory: "/"
              schedule:
                interval: "weekly"
                day: "monday"
                time: "09:00"
                timezone: "Asia/Seoul"
              labels:
                - "dependencies"
                - "github_actions"

            # 2. Dockerfile ë° Docker ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
            # í”„ë¡œì íŠ¸ ë‚´ì— Dockerfileì´ ìˆê±°ë‚˜ ì´ë¯¸ì§€ë¥¼ ì°¸ì¡°í•  ê²½ìš°
            - package-ecosystem: "docker"
              directory: "/"
              schedule:
                interval: "weekly"
              labels:
                - "docker"

            # 3. Node.js (npm) íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
            # package.jsonì´ ì¡´ì¬í•  ê²½ìš° ì˜ì¡´ì„± ìë™ ì—…ë°ì´íŠ¸
            - package-ecosystem: "npm"
              directory: "/"
              schedule:
                interval: "weekly"
              open-pull-requests-limit: 10

            # 4. Python (pip) íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
            # requirements.txt ë˜ëŠ” pyproject.tomlì´ ì¡´ì¬í•  ê²½ìš°
            - package-ecosystem: "pip"
              directory: "/"
              schedule:
                interval: "weekly"
          
            # 5. Java (Maven) íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
            # pom.xmlì´ ì¡´ì¬í•  ê²½ìš°
            - package-ecosystem: "maven"
              directory: "/"
              schedule:
                interval: "weekly"
          EOF
          
          echo "âœ… dependabot.yml content generated."
          cat .github/dependabot.yml

      - name: Commit and Push
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          
          # ë³€ê²½ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹
          git add .github/dependabot.yml
          if git diff --staged --quiet; then
            echo "No changes to commit."
          else
            git commit -m "docs: Add comprehensive dependabot.yml configuration"
            git push
            echo "ğŸš€ Successfully pushed dependabot.yml to repository."
          fi
