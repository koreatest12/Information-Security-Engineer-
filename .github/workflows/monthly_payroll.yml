name: Monthly Payroll Automation

on:
  # 1. 스케줄링: 매월 25일 오전 9시 (KST 기준 18시) 자동 실행
  # UTC 09:00 + 9시간 = KST 18:00
  schedule:
    - cron: '0 9 25 * *'
  
  # 2. 수동 실행: GitHub Actions 탭에서 버튼 클릭으로 즉시 실행 가능
  workflow_dispatch:

jobs:
  run-payroll-system:
    runs-on: ubuntu-latest
    
    # 권한 설정 (v4부터는 쓰기 권한 명시가 권장될 수 있음)
    permissions:
      contents: read
      actions: read
      checks: write

    steps:
    # [수정됨] Checkout 액션 v3 -> v4 업데이트
    - name: Checkout Repository
      uses: actions/checkout@v4

    # [수정됨] Python 셋업 액션 v4 -> v5 업데이트
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10' 

    # 필수 라이브러리 설치
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas matplotlib reportlab openpyxl numpy

    # 한글 폰트 설치 (리눅스 서버용)
    - name: Install Korean Fonts
      run: |
        sudo apt-get update
        sudo apt-get install -y fonts-nanum
        # 스크립트가 폰트를 못 찾을 경우를 대비한 시스템 폰트 설치

    # 파이썬 스크립트 실행
    - name: Run Payroll Script
      run: python payroll_master.py

    # [수정됨] Artifact 업로드 액션 v3 -> v4 (에러 해결 핵심)
    - name: Upload Payroll Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: Payroll-Result-${{ github.run_id }}
        # 파이썬 코드에서 생성하는 폴더명 패턴 (Result_202X-XX)
        path: Result_*/
        retention-days: 30
        # v4에서는 파일이 없으면 에러가 나므로, 파일 생성 여부 체크 옵션 추가 가능
        if-no-files-found: warn
