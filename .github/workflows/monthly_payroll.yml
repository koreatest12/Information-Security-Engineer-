name: Monthly Payroll Automation

# [트리거 설정]
on:
  # 1. 스케줄링: 매월 25일 오전 9시 (KST 기준 18시) 자동 실행
  schedule:
    - cron: '0 9 25 * *'
  # 2. 수동 실행: GitHub 웹사이트에서 버튼 클릭으로 즉시 실행 가능
  workflow_dispatch:

jobs:
  run-payroll-system:
    runs-on: ubuntu-latest

    steps:
    # 1. 저장소 코드 내려받기
    - name: Checkout Repository
      uses: actions/checkout@v3

    # 2. Python 환경 설정 (3.9 버전)
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 3. 필수 라이브러리 설치
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas matplotlib reportlab openpyxl pyyaml

    # 4. 한글 폰트 처리 (우분투 환경용)
    - name: Install Korean Fonts (Optional)
      run: |
        sudo apt-get update
        sudo apt-get install -y fonts-nanum
        # 파이썬 코드 내 자동 다운로드 로직이 있으므로 필수는 아님

    # 5. 급여 자동화 스크립트 실행
    - name: Run Payroll Script
      run: python payroll_master.py

    # 6. 결과물(PDF, Excel, 이미지) 업로드 (보관 기간 30일)
    - name: Upload Payroll Artifacts
      uses: actions/upload-artifact@v3
      with:
        name: Payroll-Result-${{ github.run_id }}
        path: Result_*/  # 스크립트가 생성하는 폴더명 패턴
        retention-days: 30
