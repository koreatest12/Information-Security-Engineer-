name: ğŸ›¡ï¸ Data Leakage Prevention (DLP)

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  secret-scan:
    name: ğŸ•µï¸ Gitleaks Secret Scan
    runs-on: ubuntu-latest
    permissions:
      contents: read
      security-events: write # GitHub Security íƒ­ì— ë¦¬í¬íŠ¸ ì—…ë¡œë“œ ê¶Œí•œ

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # ì „ì²´ íˆìŠ¤í† ë¦¬ë¥¼ ê°€ì ¸ì™€ì„œ ê³¼ê±°ì˜ ìœ ì¶œê¹Œì§€ íƒì§€

      # Gitleaks ì‹¤í–‰ (ë¹„ë°€ ì •ë³´ íƒì§€)
      - name: Run Gitleaks
        uses: gitleaks/gitleaks-action@v2
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          # trueì¼ ê²½ìš° ìœ ì¶œ ë°œê²¬ ì‹œ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤íŒ¨ ì²˜ë¦¬í•¨ (Merge ì°¨ë‹¨ íš¨ê³¼)
          fail-on-error: true 
          verbose: true

      # (ì„ íƒì‚¬í•­) íƒì§€ ê²°ê³¼ ë¦¬í¬íŠ¸ ì¶œë ¥
      - name: Scan Report
        if: always()
        run: |
          echo "âœ… Secret scanning completed."
          echo "If this workflow failed, please check the logs. SENSITIVE DATA DETECTED!"
